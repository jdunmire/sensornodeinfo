---
layout: post
title: "PCB Fabrication"
author: Jerry
#date: YYYY-MM-DD  # last modified if different than the filename/modification time
permalink: /blog/2017/01/12/pcbfab/
#commentIssueId: <issue number>  # optional, no comments if not defined
categories:
- blog
- Hardware
- tools
- TLPHnodeV2
img: bogdanco-Toolkit_144x144.png
thumb: bogdanco-Toolkit_70x70.png

---

These are my notes on how to get a PCB designed in [KiCAD][kicad] fabricated by
[OSH Park][OSH]. The process is easy- there isn't anything complex or tricky. I
just like to have a reference to follow.

These notes were developed while ordering the
[TLPHnodeV2][node]

[kicad]: http://kicad-pcb.org/
[node]: /component/tlphnodeV2/
[OSH]: https://oshpark.com/

<!--more-->

#### Design Rules
The first step is to make sure that the PCB matches the [OSH Park Design
Rules](http://docs.oshpark.com/services/). The best way is to configure
KiCAD with the appropriate rules before you start to layout the board.

The [TLPHnodeV2][node] is designed as a 4-layer board, so the rules are:

    * 5 mil trace clearance
    * 5 mil trace width
    * 10 mil drill size
    * 4 mil annular ring

The rules are entered in the `Pcbnew->Design Rules->Design Rules` dialog.
A good trick is to set the board units to inches
(`Pcbnew->Preferences->General`) to enter the values even if you are going
design your board using metric values. After you have entered the
minimums, you can set the board units to `mm` and Pcbnew will
automatically translate the entered values to the new units.

The other trick is that Pcbnew expects Minimum via diameter, but OSH
Park provides only the annual ring value. To get the minimum diameter,
add 2x the annular ring to the minimum drill size.

![Design Rule Dialog](/assets/img/blog/4LayerDesignRules.png){:class="img-responsive"}

Before attempting to submit a design to OSH Park, make sure you run the
Pcbnew Design Rule Checker.

#### Preparing the design
While OSH Park will [accept KiCAD][OSH_Docs_kicad] files directly,
I like to plot gerber files from KiCAD and check them manually so that I
know exactly what I am sending to OSH Park.

OSH Park provides [clear instructions][OSH_Docs_kicad] for KiCAD two-layer boards.
Four-layer boards are not much different.

[OSH_Docs_kicad]: http://docs.oshpark.com/design-tools/kicad/generating-kicad-gerbers/

#### Plot
For a four layer board these layers should be selected:

![Plot](/assets/img/blog/4LayerPlotDialog.png){:class="img-responsive"}

Note that while OSH Park says that they accept KiCAD output names, but only a 2-layer board was detected for the [TLPHnodeV2][node]- probably because I changed the names of the inner layers.

To get OSH Park to recognize all four layers I had to select `Use Protel
filename extensions`.

#### Drill File
The drill file settings are the same as the ones in the OSH Park
[instructions][OSH_Docs_kicad]. The only changes I had to make from the
KiCAD default were to un-check the `Minimal header` and select the
`Decimal Format`.

![Drill](/assets/img/blog/DrillDialog.png){:class="img-responsive"}

#### Verify
I use [gerbv][gerbv] to view the files. For a 4-layer board, there should be 10
files.

        $ cd CAM/
        $ gerbv *.g* *.drl


![gerbv](/assets/img/blog/TLPHnodeV2_gerbv.png){:class="img-responsive"}

I look to make sure that the holes and masks line up. I look for traces
that exposed because they pass through an open mask area. Such traces
can produce shorts during soldering:

![Exposed Trace](/assets/img/blog/ExposedTrace.png){:class="img-responsive"}

I also look to make sure that the silk-screen markings don't cover any pads.

[gerbv]: http://gerbv.geda-project.org/

#### Upload
OSH Park expects all of the gerbers and the drill file to be combined
into one zip file:

        $ cd CAM/
        $ zip <project>.zip *.g* *.drl

The project upload starts on the OSH Park Home page. Once the file has
been uploaded and processed the Processing Upload page will be
displayed:

  ![Processing Upload](/assets/img/blog/UploadProcessing.png){:class="img-responsive"}

Make sure that a 4-layer board was detected and that the size is about
what you expect.



