---
layout: component
title:  "TLPH Node V2"
summary: "Battery powered node to measure temperature, light levels, pressure, and humidity, with LiFePO4 charger."
started: 2017-01-11
date:   2017-01-11
status: dev
repository: https://github.com/jdunmire/TLPHnodeV2
commentIssueId: 9
permalink: /component/tlphnodeV2/
categories:
- component
- Hardware
img: TLPHnodeV2_model.png
thumb: TLPHnodeV2_model_70x53.png

---
#### Overview
This is a redesign of the [TLPHnode][TLPHnode] so that it includes a
LiFePO4 battery charger and so that it does not require a separate
[power supply and breakout board][nodePWR]. A 3.3v regulator is included
to prevent damage to components while the battery is being charged. A
micro USB connector is used to connect charging power and to for the
ESP-8266 programming signals. It is NOT a USB interface.

[TLPHnode]: /component/tlphnode/
[nodePWR]: https://github.com/jdunmire/nodePWR

#### Concept
  * Simple
  * Low cost
  * Battery operated
  * Smaller than [TLnode][TLnode]

This node adds pressure and humidity sensors to the
[TLnode][TLnode] and reduces the PCB size. The
[TLnode][TLnode] PCB size was chosen to match the 2-AA
battery holder. The concept this time will be to minimize the PCB size
and use pads to connect to the battery. This will reduce the cost of the
PCB and allow more flexibility in choosing a battery holder.

As with the [TLnode][TLnode], the PCB will be designed using
[KiCad](http://kicad-pcb.org/).  The KiCad design files, including full
schematics, are available on
[GitHub](https://github.com/jdunmire/TLPHnodeV2).

[TLnode]: /component/tlnode/

#### CPU
This node will be designed for the [same CPU][ESP8266] as the
[TLnode][TLnode], though it may be built with the [ESP-12F][ESP12F].
The [ESP-12F][ESP12F] brings out some additional pins, but they are
useful only for direct access to the flash memory and are not useful for
this node. The ESP-12E and ESP-12F have the same pinout. The ESP-12E
does not appear to be in production at this time (2016/02/01).

Some of the places ESP-12F can be purchased:

  * [Itead Studio](https://www.itead.cc/esp-12f.html)
  * [Bang good](http://www.banggood.com/ESP8266-ESP-12F-Remote-Serial-Port-WIFI-Transceiver-Wireless-Module-p-1007260.html)
  * [Adafruit](https://www.adafruit.com/products/2491)(ESP-12E)
  * [Amazon](http://www.amazon.com/s/ref=nb_sb_noss_1?url=search-alias%3Daps&field-keywords=esp8266+esp-12f&rh=i%3Aaps%2Ck%3Aesp8266+esp-12f)

[ESP8266]: https://en.wikipedia.org/wiki/ESP8266 "wiki: ESP8266"
[ESP12F]: http://www.esp8266.com/wiki/doku.php?id=esp8266-module-family#esp-12-e

#### Temperature
Both the pressure and the humidity sensors have built-in temperature
sensors, so a separate device is not needed.

#### Light
The light sensor is an Intersil [ISL29035][ISL]. It was chosen because
it has an I2C interface, its power supply range (2.25V-3.63V) and
relatively low cost ($1.67 from
[DigiKey](https://www.digikey.com/product-detail/en/ISL29035IROZ-T7/ISL29035IROZ-T7CT-ND/4499886).

This is the same sensor that I used for the [TLnode][TLnode].

[ISL]: http://www.intersil.com/en/products/optoelectronics/ambient-light-sensors/light-to-digital-sensors/ISL29035.html

#### Pressure
For pressure I've chosen the [LPS25HB][LPS25HB]:

  * resolution: 0.01 hPa ~ 0.083m @ 15 degC
  * absolute accuracy: 0.2 hPa ~ 1.66m @ 15 degC
  * relative accuracy: 0.1 hPa ~ 0.83m @ 15 degC
  * 2.5 mm x 2.5 mm x 0.76 mm

I also considered these:

  * [MPL3115A2][MPL3115A2]
      * resolution: 1.5 Pa ~ 0.125m @ 15 degC
      * absolute accuracy: 0.4 kPa ~ 33.2m @ 15 degC
      * relative accuracy: 0.05 kPa ~ 4.16m @ 15 degC
      * 5.0 mm x 3.0 mm x 1.1 mm

  * [BMP280][BMP280]
      * resolution: 0.18 Pa ~ 0.015m @ 15 degC
      * absolute accuracy: 1 hPa ~ 8.3m @ 15 degC
      * relative accuracy: 0.12 hPa ~ 0.998 @ 15 degC
      * 2.0 mm x 2.5 mm x 0.95 mm

      This is the lowest price of these sensors ($2.72
      @ Mouser), but it requires scaling (ideally using 64-bit math) by
      the host CPU.

  * [NPA-201][NPA-201]
      * resolution: 0.15 mBar ~ 0.125m @ 15 degC
      * absolute accuracy: 0.2 mBar ~ 1.6m @ 15 degC
      * relative accuracy: 0.1 mBar ~ 0.8m @ 15 degC
      * 2.0 mm x 2.5 mm x 1.0 mm

One issue with all of thesee pressure sensors is that they are also light
sensitive. Some light blocking device (foam, baffles, ???) will be
needed.

[MPL3115A2]: http://www.nxp.com/products/sensors/pressure-sensors/barometric-pressure-15-to-115-kpa/20-to-110kpa-absolute-digital-pressure-sensor:MPL3115A2

[LPS25HB]: http://www.st.com/web/catalog/sense_power/FM89/SC1316/PF261381

[BMP280]: http://www.bosch-sensortec.com/bst/products/all_products/bmp280

[NPA-201]: http://www.amphenol-sensors.com/en/products/pressure-mems/mems-sensors/3236-npa-201

#### Humidity
[Si7006-A20(PDF)][Si7006] is the low end of a [family][Si70xx] of sensors
from Silicon Labs. The key characteristics that make it my choice are:

  * +/- 5% RH
  * 150 uA active current
  *  60 nA standby current
  * 3mm x 3mm x 1.21 mm
  * 1.9-3.6 V operating voltage.

I plan to use the `-IM1` version which has a factory installed cover.

[Si7006]: http://www.silabs.com/Support%20Documents/TechnicalDocs/Si7006-A20.pdf
[Si70xx]: http://www.silabs.com/products/sensors/humidity-sensors/Pages/si7013-20-21.aspx

#### Power
The battery of choice will be one using [LiFePO4][LiFePO4] chemistry.
The power density is not as good as Li-polymer or even alkaline, but the
[voltage curve(PDF)][LiFePO4_18650_spec] is a better match to the components
selected.

There are a number of battery vendors that carry the [LiFePO4][LiFePO4]
batteries. I purchased mine from [AA Portable Power Corp][batteryspace].
I used the AA size for the [TLnode][tlnode], but the
[18650 size][batterySizes] is not
much larger and is available with up to [2.5 times][LiFePO4_1500mAh] the
capacity of the [AA batteries][LiFePO4_600mAh].

For convenience a charger for the battery will be included.

Since the fully charged voltage of an LiFePO4 can exceed the max
voltage rating of some of the devices used on this board a 3.3v
regulator will be used.

[LiFePO4]: https://en.wikipedia.org/wiki/Lithium_iron_phosphate_battery
[LiFePO4_18650_spec]: http://docs-europe.electrocomponents.com/webdocs/12fd/0900766b812fdd11.pdf
[LiFePO4_1500mAh]: http://www.batteryspace.com/lifepo4-18650-rechargeable-cell-3-2v-1500-mah-8-4a-rate-4-32wh-ul-listed-un38-3-passed-ndgr.aspx
[LiFePO4_600mAh]: http://www.batteryspace.com/lifepo4-rechargeable-14505-cell-3-2v-600-mah-0-6a-rate-2-22wh-button-top-standard-aa-size-0-18----un38-3-passed-ndgr.aspx
[batterySizes]: https://en.wikipedia.org/wiki/List_of_battery_sizes
[batteryspace]: http://www.batteryspace.com/

#### 3.3v Regulator
The 3.3v regulator must have a low quiescent current and that
current should not go up when supply voltage drops below the
regulation voltage. Two regulators have been identified as options:
[LD39130S (PDF)][LD39_ds] and 
[NCP703SN (PDF)][NCP_ds].

The [LD39130SJ33R][LD39] is the preferred choice. The complication is
that the fixed voltage versions of the LD39130S come in a package that
is less than 1mm square. That could be a problem for manual placement.
The adjustable version, [LD31130SPUR][LD39_6DFN], comes in a 6-DFN
package that I know can be manually placed. However the
[data sheet(PDF)][LD39_ds] does not provide details on how to set the
regulation voltage and [STMicroelectronics Support][STM_Support]
declined to provide any details that are not on the data sheet.

As a work-around, I also included the [NCP703SN][NCP]. The quiescent
current is a bit higher than the LD31130S, but it is available as fixed
voltage regulator in a 6-DFN package.

I found that I could place the 
LD39130SJ33R footprint inside the NCP703SN footprint so that no
additional PCB space is required. I will try mounting the LD39130SJ33R
and it that fails I can replace it with the NCP703SN without needing to
redesign the PCB.

[STM_Support]: http://www.st.com/content/st_com/en/support/online-support.html
[LD39_ds]: http://www.st.com/content/ccc/resource/technical/document/datasheet/68/14/08/87/cd/cd/48/98/DM00094312.pdf/files/DM00094312.pdf/jcr:content/translations/en.DM00094312.pdf
[LD39]: http://www.digikey.com/products/en?keywords=497-14210-1-ND
[NCP_ds]: http://www.onsemi.com/pub_link/Collateral/NCP703-D.PDF
[NCP]: http://www.digikey.com/products/en?keywords=NCP703SN33T1GOSCT
[LD39_6DFN]: http://www.digikey.com/product-detail/en/stmicroelectronics/LD39130SPUR/497-15501-1-ND/5244818


#### LiFePO4 Battery Charger
LiFePO4 batteries require specific charging profiles. The Texas
Instruments [BQ25050(PDF)][BQ25050_ds] will be used.

[BQ25050_ds]: http://www.ti.com/lit/ds/symlink/bq25050.pdf

